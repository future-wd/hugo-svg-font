{{- /*
HUGO SVG FONT
usage: {{ partial "scripts/svg-font" (dict "src" "icons/bootstrap/envelope" "em" 1 "block" true/false )}} 
*/ -}}
{{- $seed := "salt" -}}
{{- $random := delimit (shuffle (split (md5 $seed) "" )) "" -}}
{{- $src := "" -}}
{{- $size := 1 -}}
{{- $block := false -}}
{{- $title := "" -}}
{{- $desc := "" -}}
{{- /* if dict passed as context to partial */ -}}
{{- if reflect.IsMap . -}}
  {{- $src = .src -}}
  {{- with .title -}}
    {{- $title = . -}}
  {{- end -}}
  {{- with .desc -}}
    {{- $desc = . -}}
  {{- end -}}
  {{- /* declare size for svg style */ -}}
  {{- $size := .em | default 1 -}}
  {{- /* display: block style conditional - keeps a square svg square but not useful for use inline with text */ -}}
  {{- with .block -}}
    {{- $block = true -}}
  {{- end -}}
{{- else -}}
  {{- /* if called with {{ partial "svg-font" "/icons/name.svg" }}           */ -}}
  {{- $src = . -}}
{{- end -}}
{{- /* add svg file suffix if not present in $src  */ -}}
{{- $glob := "%s.svg" -}}
{{- if strings.HasSuffix $src ".src" -}}
  {{- $glob = "%s.*" -}}
{{- end -}}
{{- /* get svg file from resources folder  */ -}}
{{- $svgFile := resources.Get (printf $glob $src ) -}}
{{- /* get svg content */ -}}
{{- $svgContent := $svgFile.Content -}}
{{- /* extract text components from svg file with regex  */ -}}
{{- $height := index (findRE `height=\"([0-9]*)\"` $svgContent 1) 0 -}}
{{- $width := index (findRE `width=\"([0-9]*)\"` $svgContent 1) 0 -}}
{{- $viewBox := index (findRE `viewBox=\"([0-9\s]*)\"` $svgContent 1) 0 -}}
{{- $content := delimit (findRE `<path(.*)/>` $svgContent) "" -}}
{{- /* format title */ -}}
{{- $ariaTitle := "" -}}
{{- with $title -}}
  {{- $titleId := printf "%s-title" $random }}
  {{- $title = printf `<title id="%s">%s</title>` $titleId . -}}
  {{- $ariaTitle = printf `aria-labelledby="%s"` $titleId -}}
{{- end -}}
{{- /* format desc */ -}}
{{- $ariaDesc := "" -}}
{{- with $desc -}}
  {{- $descId := printf "%s-desc" $random }}
  {{- $desc = printf `<desc id="%s">%s</desc>` $descId . -}}
  {{- $ariaDesc = printf `aria-describedby="%s"` $descId -}}
{{- end -}}
{{- /* assign classes */ -}}
{{- $class := (slice "svg-font" (printf "em-%v" $size)) -}}
{{- if $block -}}
{{- $class = $class | append "d-block" -}}
{{- end -}}
{{- $class = delimit $class " " -}}
{{- $class = printf `class="%s"` $class -}}
{{- $attr := (slice $height $width $viewBox $class $ariaTitle $ariaDesc) -}}
{{- $svgModified := printf `<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" %s>%v %v %v</svg>` (delimit $attr " ") $title $desc $content -}}
{{- $svgModified | safeHTML -}}
